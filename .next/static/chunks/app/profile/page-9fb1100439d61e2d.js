(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{2417:function(e,s,n){Promise.resolve().then(n.bind(n,112))},112:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return l}});var r=n(7437),i=n(9376),t=n(2265),a=n(970);function l(){let e=(0,i.useRouter)(),[s,n]=(0,t.useState)({}),[l,c]=(0,t.useState)([]),[d,o]=(0,t.useState)([]),[u,h]=(0,t.useState)({}),[m,x]=(0,t.useState)(!0);if((0,t.useEffect)(()=>{(async()=>{try{let s=(0,a.e)(),{data:{user:r},error:i}=await s.auth.getUser();if(i||!r){console.error("No authenticated user:",i),e.push("/auth/login");return}let{data:t,error:l}=await s.from("businesses").select("*").eq("user_id",r.id).single();if(l){console.error("Failed to load business:",l),e.push("/auth/login");return}n(t);let{data:d,error:u}=await s.from("products").select("*").eq("business_id",t.id);u||c(d||[]);let{data:m,error:x}=await s.from("reviews").select("\n            *,\n            products(name)\n          ").eq("business_id",t.id);if(!x&&m){let e=m.map(e=>{var s;return{id:e.id,customer_name:e.customer_name,product_name:(null===(s=e.products)||void 0===s?void 0:s.name)||"Unknown Product",rating:e.rating,text:e.text,sentiment:e.sentiment,is_fake:e.is_fake,reply:e.reply}});o(e);let s={};e.forEach(e=>{let n=e.rating;s[n]=(s[n]||0)+1}),h(s)}localStorage.setItem("business",JSON.stringify(t)),localStorage.setItem("loggedInBusiness",JSON.stringify(t))}catch(e){console.error("Failed to load profile:",e)}finally{x(!1)}})()},[e]),m)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-teal-600"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading profile..."})]})});let p=d.length,j=p?(d.reduce((e,s)=>e+s.rating,0)/p).toFixed(1):"N/A";return(0,r.jsxs)("div",{className:"profile-container",children:[(0,r.jsx)("h1",{children:s.name||"Business Profile \uD83D\uDC64"}),(0,r.jsxs)("div",{className:"business-contact card",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Phone:"})," ",s.phone||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Location:"})," ",s.country,", ",s.state]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",s.email||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Opening Hours:"})," ",s.hours||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Average Rating:"})," ",j," ⭐"]})]}),(0,r.jsxs)("div",{className:"description card",children:[(0,r.jsx)("h2",{children:"About Us \uD83D\uDCDD"}),(0,r.jsx)("p",{children:s.description||"No description available. \uD83D\uDE1E"})]}),(0,r.jsxs)("div",{className:"products-section card",children:[(0,r.jsx)("h2",{children:"Our Products \uD83D\uDCE6"}),l.length>0?(0,r.jsx)("ul",{className:"product-list",children:l.map((e,s)=>(0,r.jsx)("li",{children:e.name},s))}):(0,r.jsx)("p",{children:"No products listed. \uD83D\uDE1E"})]}),(0,r.jsxs)("div",{className:"rating-distribution card",children:[(0,r.jsx)("h2",{children:"Rating Distribution \uD83D\uDCCA"}),[5,4,3,2,1].map(e=>{let s=u[e]||0,n=p?s/p*100:0;return(0,r.jsxs)("div",{className:"rating-bar",children:[(0,r.jsxs)("span",{children:[e,"⭐"]}),(0,r.jsx)("div",{className:"bar",children:(0,r.jsx)("div",{className:"bar-fill",style:{width:"".concat(n,"%")}})}),(0,r.jsx)("span",{children:s})]},e)})]}),(0,r.jsxs)("div",{className:"reviews-section card",children:[(0,r.jsx)("h2",{children:"Customer Reviews \uD83D\uDCDD"}),d.length>0?(0,r.jsx)("div",{className:"review-list",children:d.map((e,s)=>(0,r.jsxs)("div",{className:"review-line",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:e.customer_name})," • ",e.product_name," • ",e.rating,"⭐ •",(0,r.jsxs)("span",{className:"review-text",children:['"',e.text,'"']})," • Sentiment: ",e.sentiment||"Unknown",e.is_fake&&(0,r.jsx)("span",{className:"fake-inline",children:" • \uD83D\uDEA9 Fake"})]}),e.reply&&(0,r.jsxs)("p",{className:"reply-line",children:["↪ ",(0,r.jsx)("strong",{children:"Business Reply:"})," ",e.reply]}),(0,r.jsx)("hr",{className:"review-divider"})]},s))}):(0,r.jsx)("p",{children:"No reviews yet. \uD83D\uDE1E"})]}),(0,r.jsxs)("div",{className:"nav-buttons",children:[(0,r.jsx)("button",{onClick:()=>e.push("/"),children:"\uD83C\uDFE0 Back to Home"}),(0,r.jsx)("button",{onClick:()=>e.push("/search"),children:"\uD83D\uDD0D Go to Business List"})]})]})}},970:function(e,s,n){"use strict";n.d(s,{e:function(){return t}});var r=n(1388),i=n(257);function t(){return(0,r.createBrowserClient)(i.env.NEXT_PUBLIC_SUPABASE_URL,i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[441,971,117,744],function(){return e(e.s=2417)}),_N_E=e.O()}]);