(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[672],{2819:function(e,t,s){Promise.resolve().then(s.bind(s,7603))},7603:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var r=s(7437),n=s(9376),i=s(2265),a=s(970);function l(){let e=(0,n.useRouter)(),[t,s]=(0,i.useState)(""),[l,c]=(0,i.useState)([]),[u,o]=(0,i.useState)([]),[d,h]=(0,i.useState)(null),[m,f]=(0,i.useState)([]),[x,v]=(0,i.useState)(""),[j,p]=(0,i.useState)(""),[g,b]=(0,i.useState)(""),[w,S]=(0,i.useState)(0),[N,_]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{let e=(0,a.e)(),{data:t,error:s}=await e.from("businesses").select("id, name, country, state");if(s){console.error("Error fetching businesses:",s);return}c(t||[])}catch(e){console.error("Error fetching businesses:",e)}})()},[]);let E=async e=>{h(e),s(""),o([]);try{let t=(0,a.e)(),{data:s,error:r}=await t.from("products").select("*").eq("business_id",e.id);if(r){console.error("Error fetching products:",r);return}f(s||[])}catch(e){console.error("Error fetching products:",e)}},y=async()=>{if(!x||!j||!g||!w){alert("Please complete all fields.");return}_(!0);try{let t=(0,a.e)(),s=m.find(e=>e.name===j);if(!s){alert("Selected product not found.");return}let{error:r}=await t.from("reviews").insert([{business_id:d.id,product_id:s.id,customer_name:x,text:g,rating:w,sentiment:null,is_fake:!1,reply:null}]);if(r)throw r;e.push("/thank-you")}catch(e){console.error("Error submitting review:",e),alert("Error submitting review. Please try again.")}finally{_(!1)}};return(0,r.jsxs)("div",{className:"review-page",children:[(0,r.jsx)("h1",{children:"Leave a Review"}),!d&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"text",placeholder:"Search for a business...",value:t,onChange:e=>{let t=e.target.value;s(t),""===t.trim()?o([]):o(l.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())))},className:"search-input"}),""!==t.trim()&&u.length>0&&(0,r.jsx)("div",{className:"business-list",children:u.map((e,t)=>(0,r.jsxs)("div",{className:"business-item",onClick:()=>E(e),children:[(0,r.jsx)("strong",{children:e.name})," - ",e.country,", ",e.state]},t))}),""!==t.trim()&&0===u.length&&(0,r.jsx)("p",{children:"No businesses found. \uD83D\uDE1E"})]}),d&&(0,r.jsxs)("div",{className:"review-form",children:[(0,r.jsxs)("h2",{children:["Reviewing: ",d.name]}),(0,r.jsxs)("table",{className:"review-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Customer Name"}),(0,r.jsx)("th",{children:"Product"}),(0,r.jsx)("th",{children:"Review"}),(0,r.jsx)("th",{children:"Rating"})]})}),(0,r.jsx)("tbody",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("input",{type:"text",value:x,onChange:e=>v(e.target.value),placeholder:"Your name"})}),(0,r.jsx)("td",{children:(0,r.jsxs)("select",{value:j,onChange:e=>p(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- Select Product --"}),m.map((e,t)=>(0,r.jsx)("option",{value:e.name,children:e.name},t))]})}),(0,r.jsx)("td",{children:(0,r.jsx)("textarea",{value:g,onChange:e=>b(e.target.value),placeholder:"Write your review..."})}),(0,r.jsx)("td",{children:(0,r.jsx)("div",{className:"star-rating",children:[1,2,3,4,5].map(e=>(0,r.jsx)("span",{className:e<=w?"filled":"",onClick:()=>S(e),children:"â˜…"},e))})})]})})]}),(0,r.jsx)("button",{onClick:y,className:"submit-btn",disabled:N,children:N?"Submitting Review...":"Submit Review"})]})]})}},970:function(e,t,s){"use strict";s.d(t,{e:function(){return i}});var r=s(1388),n=s(257);function i(){return(0,r.createBrowserClient)(n.env.NEXT_PUBLIC_SUPABASE_URL,n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[441,971,117,744],function(){return e(e.s=2819)}),_N_E=e.O()}]);